# Narrative Engine

Интерактивная система генерации текстовых квестов с использованием искусственного интеллекта.

## Описание проекта

Narrative Engine - это веб-приложение для создания уникальных текстовых квестов с помощью Mistral AI. Проект состоит из двух частей:

- **API сервер** (Django + Python) - генерирует квесты с помощью ИИ
- **Клиент** (Vue.js) - веб-интерфейс для создания и просмотра квестов

## Структура проекта

```
Narrative_Engine/
├── api/                    # Django API сервер
│   ├── src/
│   │   ├── quest_app/     # Основное приложение
│   │   ├── quest_project/ # Настройки Django
│   │   └── manage.py
│   ├── pyproject.toml     # Зависимости Python
│   └── output/           # Сгенерированные квесты
└── client/               # Vue.js клиент
    ├── src/
    │   ├── components/   # Vue компоненты
    │   └── App.vue
    └── package.json
```

## Установка и настройка

### Предварительные требования

- Python 3.8+
- Node.js 16+
- API ключ Mistral AI

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd Narrative_Engine
```

### 2. Настройка API сервера

```bash
cd api

# Установка зависимостей
pip install poetry
poetry install

# Копирование файла настроек
cp env_example.txt .env

# Редактирование .env файла
# Добавьте ваш API ключ Mistral AI:
# MISTRAL_API_KEY=your_api_key_here
```

### 3. Настройка базы данных

```bash
cd src
python manage.py migrate
python manage.py createsuperuser  # опционально
```

### 4. Настройка клиента

```bash
cd ../../client

# Установка зависимостей
npm install
```

## Запуск проекта

### 1. Запуск API сервера

```bash
cd api/src
python manage.py runserver
```

API будет доступен по адресу: http://localhost:8000

### 2. Запуск клиента

```bash
cd client
npm run dev
```

Клиент будет доступен по адресу: http://localhost:5173

## Использование

### Создание квеста

1. Откройте веб-интерфейс в браузере
2. Заполните форму создания квеста:

   - **Жанр**: фэнтези, киберпанк, детектив и т.д.
   - **Герой**: описание главного персонажа
   - **Цель**: основная задача квеста
   - **Количество сцен**: от 5 до 10
   - **Максимальная глубина**: сложность ветвления
   - **Сложность**: простой, средний, сложный, эпический
   - **Тип концовок**: одна, множественные, разветвленные

3. Нажмите "Создать квест"
4. Дождитесь генерации (может занять 10-30 секунд)

### Просмотр квестов

- Все созданные квесты сохраняются в базе данных
- Квесты также сохраняются в JSON файлы в папке `api/output/`
- В веб-интерфейсе можно просматривать историю квестов

## API Endpoints

### Создание квеста

```
POST /api/generate/
Content-Type: application/json

{
  "genre": "фэнтези",
  "hero": "маг-одиночка",
  "goal": "найти древний артефакт",
  "scene_count": 8,
  "max_depth": 4,
  "complexity": "medium",
  "ending_type": "single"
}
```

### Получение списка квестов

```
GET /api/quests/
```

### Получение конкретного квеста

```
GET /api/quests/{id}/
```

## Структура квеста

Каждый квест содержит массив сцен:

```json
{
  "scenes": [
    {
      "scene_id": "village_gate",
      "text": "Описание сцены...",
      "choices": [
        {
          "text": "Описание выбора",
          "next_scene": "next_scene_id"
        }
      ]
    }
  ]
}
```

### Правила структуры квеста

- Каждая сцена имеет уникальный `scene_id`
- Все сцены должны иметь минимум 2 выбора (кроме `quest_end`)
- Сцена `quest_end` - финальная сцена квеста
- Все пути должны вести к `quest_end`
- Минимум 5 сцен в квесте

## Настройка Mistral AI

### Получение API ключа

1. Зарегистрируйтесь на [Mistral AI](https://mistral.ai/)
2. Создайте API ключ в личном кабинете
3. Добавьте ключ в файл `.env`:

```
MISTRAL_API_KEY=your_api_key_here
```

### Настройка модели

В файле `api/src/quest_project/settings.py` можно изменить модель:

```python
MISTRAL_MODEL = "mistral-large-latest"  # или "mistral-medium-latest"
```

## Разработка

### Структура кода

#### API (Django)

- `quest_app/models.py` - модели данных
- `quest_app/views.py` - API endpoints
- `quest_app/llm_generator.py` - генерация квестов с помощью ИИ
- `quest_app/serializers.py` - сериализация данных

#### Клиент (Vue.js)

- `components/QuestGenerator.vue` - форма создания квеста
- `components/QuestHistory.vue` - история квестов
- `components/QuestGraph.vue` - визуализация структуры квеста

### Добавление новых функций

1. **Новые поля квеста**: отредактируйте модели в `models.py`
2. **Новые параметры генерации**: добавьте в `llm_generator.py`
3. **Новые компоненты**: создайте в `client/src/components/`

### Тестирование

```bash
# Тесты API
cd api/src
python manage.py test quest_app.tests

# Тесты клиента
cd client
npm run test
```

## Устранение неполадок

### Проблемы с API ключом

```
Ошибка: Mistral AI не настроен
```

**Решение:**

1. Проверьте файл `.env` в папке `api/`
2. Убедитесь, что `MISTRAL_API_KEY` установлен
3. Проверьте правильность API ключа

### Проблемы с генерацией

```
Ошибка: Ошибка парсинга JSON
```

**Решение:**

1. Проверьте подключение к интернету
2. Убедитесь, что API ключ активен
3. Попробуйте уменьшить количество сцен

### Проблемы с базой данных

```bash
# Сброс базы данных
cd api/src
python manage.py flush

# Пересоздание миграций
python manage.py makemigrations
python manage.py migrate
```

## Производительность

### Оптимизация генерации

- Используйте `mistral-medium-latest` для быстрой генерации
- Уменьшите `max_tokens` для экономии токенов
- Установите `scene_count` в диапазоне 5-8 для оптимальной скорости

### Мониторинг

- Логи API сервера: `api/src/logs/`
- Сгенерированные квесты: `api/output/`
- Статистика использования в Django Admin

## Лицензия

MIT License

## Поддержка

При возникновении проблем:

1. Проверьте раздел "Устранение неполадок"
2. Изучите логи в консоли
3. Создайте issue в репозитории проекта

## Вклад в проект

1. Fork репозитория
2. Создайте feature branch
3. Внесите изменения
4. Создайте Pull Request

---

**Версия**: 1.0.0  
**Последнее обновление**: Август 2025
